"use strict";var h=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var E=(a,o)=>{for(var i in o)h(a,i,{get:o[i],enumerable:!0})},F=(a,o,i,u)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of B(o))!D.call(a,r)&&r!==i&&h(a,r,{get:()=>o[r],enumerable:!(u=x(o,r))||u.enumerable});return a};var M=a=>F(h({},"__esModule",{value:!0}),a);var R={};E(R,{default:()=>m});module.exports=M(R);var t=require("@raycast/api"),f=require("child_process"),p=require("react"),l=require("react/jsx-runtime");function m(){let[a,o]=(0,p.useState)([]),[i,u]=(0,p.useState)(void 0),r=t.preferences.shouldSearchInPaths?.value??!1,y=t.preferences.shouldSearchInPid?.value??!1,b=t.preferences.shouldPrioritizeAppsWhenFiltering?.value??!1,I=t.preferences.shouldShowPID?.value??!1,S=t.preferences.shouldShowPath?.value??!1,P=()=>{(0,f.exec)("ps -eo pid,pcpu,comm | sort -nrk 2,3",(e,n)=>{if(e!=null)return;let s=n.split(`
`).map(c=>{let[,$,k,d]=c.match(/(\d+)\s+(\d+[.|,]\d+)\s+(.*)/)??["","","",""],L=d.match(/[^/]*[^/]*$/i)?.[0]??"",T=d.includes(".prefPane"),v=d.includes(".app");return{id:$,cpu:k,path:d,name:L,type:T?"prefPane":v?"app":"binary"}}).filter(c=>c.name!=="");o(s)})};(0,p.useEffect)(()=>{P()},[]);let g=e=>e.type==="prefPane"?{fileIcon:e.path?.replace(/(.+\.prefPane)(.+)/,"$1")??""}:e.type==="app"?{fileIcon:e.path?.replace(/(.+\.app)(.+)/,"$1")??""}:"/System/Library/CoreServices/CoreTypes.bundle/Contents/Resources/ExecutableBinaryIcon.icns",C=e=>{(0,f.exec)(`kill -9 ${e.id}`),o(a.filter(n=>n.id!==e.id)),(0,t.clearSearchBar)({forceScrollToTop:!0}),(0,t.showHUD)(`\u2705 Killed ${e.name==="-"?`process ${e.id}`:e.name}`)},w=e=>e.path==null?null:(0,l.jsx)(t.CopyToClipboardAction,{title:"Copy Path",content:e.path}),A=e=>{let n;return I&&(n=e.id),S&&(n=n?`${n} - ${e.path}`:e.path),n};return(0,l.jsx)(t.List,{isLoading:a.length===0,searchBarPlaceholder:"Filter by name...",onSearchTextChange:e=>u(e),children:a.filter(e=>{if(i==null)return!0;let n=e.name.toLowerCase().includes(i.toLowerCase()),s=e.path?.toLowerCase().match(new RegExp(`.+${i}.*\\.[app|framework|prefpane]`,"ig"))!=null,c=e.id.includes(i);return n||r&&s||y&&c}).sort((e,n)=>{if(i!=null&&b){if(e.type==="app"&&n.type!=="app")return-1;if(e.type!=="app"&&n.type==="app")return 1}return 0}).map((e,n)=>{let s=g(e);return(0,l.jsx)(t.List.Item,{title:e.name,subtitle:A(e),icon:s,accessoryTitle:`${e.cpu}%`,actions:(0,l.jsxs)(t.ActionPanel,{children:[(0,l.jsx)(t.ActionPanel.Item,{title:"Kill",icon:t.Icon.XmarkCircle,onAction:()=>C(e)}),w(e),(0,l.jsx)(t.ActionPanel.Item,{title:"Reload",icon:t.Icon.ArrowClockwise,shortcut:{key:"r",modifiers:["cmd"]},onAction:()=>P()})]})},n)})})}0&&(module.exports={});
